#!/usr/bin/env node

/**
 * Firebase Setup Script for GoogleTechSprint
 *
 * This script helps you set up Firebase authentication for the project.
 * Run this after creating your Firebase project and obtaining the credentials.
 */

const fs = require('fs');
const path = require('path');

console.log('üî• Firebase Setup Script for GoogleTechSprint');
console.log('==============================================\n');

console.log('üìã REQUIRED: Create a Firebase project first!');
console.log('1. Go to https://console.firebase.google.com/');
console.log('2. Click "Create a project" (or use existing)');
console.log('3. Enable Authentication > Email/Password');
console.log('4. Get your config from Project Settings > General > Your apps\n');

console.log('üîë Enter your Firebase configuration below:\n');

const readline = require('readline');
const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

function askQuestion(question) {
  return new Promise((resolve) => {
    rl.question(question, (answer) => {
      resolve(answer.trim());
    });
  });
}

async function setupFirebase() {
  try {
    const apiKey = await askQuestion('Firebase API Key: ');
    const authDomain = await askQuestion('Auth Domain (e.g., your-project.firebaseapp.com): ');
    const projectId = await askQuestion('Project ID: ');
    const storageBucket = await askQuestion('Storage Bucket (e.g., your-project.appspot.com): ');
    const messagingSenderId = await askQuestion('Messaging Sender ID: ');
    const appId = await askQuestion('App ID: ');

    if (!apiKey || !authDomain || !projectId || !storageBucket || !messagingSenderId || !appId) {
      console.log('\n‚ùå All fields are required!');
      rl.close();
      return;
    }

    // Update .env.local
    const envContent = `# Firebase Configuration
# Generated by setup-firebase.js

NEXT_PUBLIC_FIREBASE_API_KEY=${apiKey}
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=${authDomain}
NEXT_PUBLIC_FIREBASE_PROJECT_ID=${projectId}
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=${storageBucket}
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=${messagingSenderId}
NEXT_PUBLIC_FIREBASE_APP_ID=${appId}
`;

    fs.writeFileSync('.env.local', envContent);
    console.log('\n‚úÖ Updated .env.local with Firebase credentials');

    // Update test-firebase.html
    const testFilePath = 'public/test-firebase.html';
    if (fs.existsSync(testFilePath)) {
      let testContent = fs.readFileSync(testFilePath, 'utf8');
      testContent = testContent.replace(
        /apiKey: "[^"]*"/,
        `apiKey: "${apiKey}"`
      );
      testContent = testContent.replace(
        /authDomain: "[^"]*"/,
        `authDomain: "${authDomain}"`
      );
      testContent = testContent.replace(
        /projectId: "[^"]*"/,
        `projectId: "${projectId}"`
      );
      testContent = testContent.replace(
        /storageBucket: "[^"]*"/,
        `storageBucket: "${storageBucket}"`
      );
      testContent = testContent.replace(
        /messagingSenderId: "[^"]*"/,
        `messagingSenderId: "${messagingSenderId}"`
      );
      testContent = testContent.replace(
        /appId: "[^"]*"/,
        `appId: "${appId}"`
      );

      fs.writeFileSync(testFilePath, testContent);
      console.log('‚úÖ Updated public/test-firebase.html with Firebase credentials');
    }

    console.log('\nüéâ Firebase setup complete!');
    console.log('\nüìù Next steps:');
    console.log('1. Create test users in Firebase Console > Authentication');
    console.log('2. Run: npm run dev');
    console.log('3. Test login at: http://localhost:3000/test-firebase.html');

  } catch (error) {
    console.error('‚ùå Error:', error.message);
  } finally {
    rl.close();
  }
}

setupFirebase();
